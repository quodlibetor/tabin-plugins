<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `scripts` mod in crate `tabin_plugins`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, scripts">

    <title>tabin_plugins::scripts - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle">
    
    <link rel="stylesheet" type="text/css" href="../../dark.css">
    <link rel="stylesheet" type="text/css" href="../../main.css" id="themeStyle">
    <script src="../../storage.js"></script>
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        <div class="sidebar-menu">&#9776;</div>
        
        <p class='location'>Module scripts</p><div class="sidebar-elems"><p class='location'><a href='../index.html'>tabin_plugins</a></p><script>window.sidebarCurrent = {name: 'scripts', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script></div>
    </nav>

    <div class="theme-picker">
        <button id="theme-picker" aria-label="Pick another theme!">
            <img src="../../brush.svg" width="18" alt="Pick another theme!">
        </button>
        <div id="theme-choices"></div>
    </div>
    <script src="../../theme.js"></script>
    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>tabin_plugins</a>::<wbr><a class="mod" href=''>scripts</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/tabin_plugins/scripts.rs.html#1-400' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Documentation about the various scripts contained herein</p>
<ul>
<li><a href="#check-graphite">check-graphite</a></li>
<li><a href="#check-cpu">check-cpu</a></li>
<li><a href="#check-container-cpu">check-container-cpu</a></li>
<li><a href="#check-load">check-load</a></li>
<li><a href="#check-ram">check-ram</a></li>
<li><a href="#check-container-ram">check-container-ram</a></li>
<li><a href="#check-procs">check-procs</a></li>
<li><a href="#check-fs-writeable">check-fs-writeable</a></li>
<li><a href="#check-disk">check-disk</a></li>
</ul>
<h1 id="check-graphite" class="section-header"><a href="#check-graphite">check-graphite</a></h1>
<p>Cross platform, only requires access to a graphite instance.</p>
<pre><code class="language-plain">$ check-graphite --help
check-graphite (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Query graphite and exit based on predicates

USAGE:
    check-graphite [FLAGS] [OPTIONS] &lt;URL&gt; &lt;PATH&gt; &lt;ASSERTION&gt;...

FLAGS:
    -h, --help                 Prints help information
        --print-url            Unconditionally print the graphite url queried
    -V, --version              Prints version information
        --verify-assertions    Just check assertion syntax, do not query urls

OPTIONS:
        --graphite-error &lt;GRAPHITE_ERROR_STATUS&gt;
            What to say if graphite returns a 500 or invalid JSON. Default: unknown. [possible values: ok, warning,
            critical, unknown]
        --no-data &lt;NO_DATA_STATUS&gt;
            What to do with no data. This is the value to use for the assertion 'if all values are null' Default: warn.
            [possible values: ok, warning, critical, unknown]
        --retries &lt;COUNT&gt;                           How many times to retry reaching graphite. Default 4.
    -w, --window &lt;MINUTES&gt;                          How many minutes of data to test. Default 10.
        --window-start &lt;MINUTES_IN_PAST&gt;            How far back to start the window. Default is now.

ARGS:
    &lt;URL&gt;             The domain to query graphite. Must include scheme (http/s)
    &lt;PATH&gt;            The graphite path to query. For example: &quot;collectd.*.cpu&quot;
    &lt;ASSERTION&gt;...    The assertion to make against the PATH. See Below.

About Assertions:

    Assertions look like 'critical if any point in any series is &gt; 5'.

    They describe what you care about in your graphite data. The structure of
    an assertion is as follows:

        &lt;errorkind&gt; if &lt;point spec&gt; [in &lt;series spec&gt;] is|are [not] &lt;operator&gt; &lt;threshold&gt;

    Where:

        - `errorkind` is either `critical` or `warning`
        - `point spec` can be one of:
            - `any point`
            - `all points`
            - `at least &lt;N&gt;% of points`
            - `most recent point`
        - `series spec` (optional) can be one of:
            - `any series`
            - `all series`
            - `at least &lt;N&gt;% of series`
            - `not` is optional, and inverts the following operator
        - `operator` is one of: `==` `!=` `&lt;` `&gt;` `&lt;=` `&gt;=`
        - `threshold` is a floating-point value (e.g. 100, 78.0)

    Here are some example assertions:

        - `critical if any point is &gt; 0`
        - `critical if any point in at least 40% of series is &gt; 0`
        - `critical if any point is not &gt; 0`
        - `warning if any point is == 9`
        - `critical if all points are &gt; 100.0`
        - `critical if at least 20% of points are &gt; 100`
        - `critical if most recent point is &gt; 5`
        - `critical if most recent point in all series are == 0`

</code></pre>
<h1 id="check-cpu" class="section-header"><a href="#check-cpu">check-cpu</a></h1>
<p>Linux-only.</p>
<pre><code class="language-plain">$ check-cpu --help
check-cpu  (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check cpu usage of the current computer

USAGE:
    check-cpu [FLAGS] [OPTIONS]

FLAGS:
    -h, --help       Prints help information
        --per-cpu    Gauge values per-cpu instead of across the entire machine
    -V, --version    Prints version information

OPTIONS:
        --show-hogs &lt;count&gt;        Show &lt;count&gt; most cpu-intensive processes in this container. [default: 0]
        --cpu-count &lt;cpu_count&gt;    If --per-cpu is specified, this is how many
                                                                CPUs need to be at a threshold to trigger. [default: 1]
    -c, --crit &lt;crit&gt;              Percent to go critical at [default: 80]
    -s, --sample &lt;seconds&gt;         Seconds to take sample over [default: 5]
    -w, --warn &lt;warn&gt;              Percent to warn at [default: 80]
        --type &lt;work_type&gt;...      See 'CPU Work Types, below [default: active]

CPU Work Types:

    Specifying one of the CPU kinds via `--type` checks that kind of
    utilization. The default is to check total utilization. Specifying this
    multiple times alerts if *any* of the CPU usage types are critical.

    There are three CPU type groups: `active` `activeplusiowait` and
    `activeminusnice`. `activeplusiowait` considers time spent waiting for IO
    to be busy time, this gets alerts to be more aligned with the overall
    system load, but is different from CPU usage reported by `top` since the
    CPU isn't actually *busy* during this time.

    --type=&lt;usage&gt;           Some of:
                                active activeplusiowait activeminusnice
                                user nice system irq softirq steal guest
                                idle iowait [default: active]

</code></pre>
<h1 id="check-container-cpu" class="section-header"><a href="#check-container-cpu">check-container-cpu</a></h1>
<p>Linux-only. Can only be run from inside a cgroup.</p>
<pre><code class="language-plain">$ check-container-cpu --help
check-container-cpu (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check the cpu usage of the currently-running container.

This must be run from inside the container to be checked.

USAGE:
    check-container-cpu [OPTIONS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --show-hogs &lt;count&gt;                  Show &lt;count&gt; most cpu-intensive processes in this container. [default: 0]
    -c, --crit &lt;crit&gt;                        Percent to go critical at [default: 80]
    -s, --sample &lt;seconds&gt;                   Seconds to take sample over [default: 5]
        --shares-per-cpu &lt;shares_per_cpu&gt;    The number of CPU shares given to a cgroup when it has exactly one CPU
                                             allocated to it.
    -w, --warn &lt;warn&gt;                        Percent to warn at [default: 80]

About usage percentages:

    If you don't specify '--shares-per-cpu', percentages should be specified
    relative to a single CPU's usage. So if you have a process that you want to
    be allowed to use 4 CPUs worth of processor time, and you were planning on
    going critical at 90%, you should specify something like '--crit 360'

    However, if you are using a container orchestrator such as Mesos, you often
    tell it that you want this container to have '2 CPUs' worth of hardware.
    Your scheduler is responsible for deciding how many cgroup cpu shares 1
    CPU's worth of time is, and keeping track of how many shares it has doled
    out, and then schedule your containers to run with 2 CPUs worth of CPU
    shares. Assuming that your scheduler uses the default number of shares
    (1024) as 'one cpu', this will mean that you have given that cgroup 2048
    shares.

    If you do specify --shares-per-cpu then the percentage that you give will
    be scaled by the number of CPUs worth of shares that this container has
    been given, and CPU usage will be compared to the total percent of the CPUs
    that it has been allocated.

    Which is to say, if you specify --shares-per-cpu, you should always specify
    your warn/crit percentages out of 100%, because this script will correctly
    scale it for your process.

    Here are some examples, where 'shares granted' is the value in
    /sys/fs/cgroup/cpu/cpu.shares:

        * args: --shares-per-cpu 1024 --crit 90
          shares granted: 1024
          percent of one CPU to alert at: 90
        * args: --shares-per-cpu 1024 --crit 90
          shares granted: 2024
          percent of one CPU to alert at: 180
        * args: --shares-per-cpu 1024 --crit 90
          shares granted: 102
          percent of one CPU to alert at: 9

</code></pre>
<h1 id="check-load" class="section-header"><a href="#check-load">check-load</a></h1>
<p>Linux-only.</p>
<pre><code class="language-plain">$ check-load --help
check-load (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check the load average of the system

Load average is the number of processes *waiting* to do work in a queue, either due to IO or CPU constraints. The
numbers used to check are the load averaged over 1, 5 and 15 minutes, respectively

USAGE:
    check-load [FLAGS] [OPTIONS]

FLAGS:
    -h, --help       Prints help information
        --per-cpu    Divide the load average by the number of processors on the system.
    -V, --version    Prints version information
    -v, --verbose    print info even if everything is okay

OPTIONS:
    -c, --crit &lt;crit&gt;    Averages to go critical at [default: 10,5,3]
    -w, --warn &lt;warn&gt;    Averages to warn at [default: 5,3.5,2.5]

</code></pre>
<h1 id="check-ram" class="section-header"><a href="#check-ram">check-ram</a></h1>
<p>Linux-only.</p>
<pre><code class="language-plain">$ check-ram --help
check-ram (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check the ram usage of the current computer

USAGE:
    check-ram [OPTIONS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --show-hogs &lt;count&gt;    Show &lt;count&gt; most ram-intensive processes in this computer. [default: 0]
    -c, --crit &lt;crit&gt;          Percent to go critical at [default: 95]
    -w, --warn &lt;warn&gt;          Percent to warn at [default: 85]

</code></pre>
<h1 id="check-container-ram" class="section-header"><a href="#check-container-ram">check-container-ram</a></h1>
<p>Linux-only. Can only be run from inside a cgroup.</p>
<pre><code class="language-plain">$ check-container-ram --help
check-container-ram (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check the RAM usage of the currently-running container.

This must be run from inside the container to be checked.

This checks as a ratio of the limit specified in the cgroup memory limit, and if there is no limit set (or the limit is
greater than the total memory available on the system) this checks against the total system memory.

USAGE:
    check-container-ram [OPTIONS]

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

OPTIONS:
        --show-hogs &lt;count&gt;                Show &lt;count&gt; most ram-intensive processes in this container. [default: 0]
    -c, --crit &lt;crit&gt;                      Percent to go critical at [default: 95]
        --invalid-limit &lt;invalid_limit&gt;    Status to consider this check if the CGroup limit is greater than the system
                                           ram [default: ok]
    -w, --warn &lt;warn&gt;                      Percent to warn at [default: 85]

</code></pre>
<h1 id="check-procs" class="section-header"><a href="#check-procs">check-procs</a></h1>
<p>Linux-only. Reads running processes</p>
<pre><code class="language-plain">$ check-procs --help
check-procs (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check that an expected number of processes are running.

Optionally, kill unwanted processes.

USAGE:
    check-procs [FLAGS] [OPTIONS] [--] [pattern]

FLAGS:
        --allow-unparseable-procs    In combination with --crit-over M this will not alert if any processes cannot be
                                     parsed
    -h, --help                       Prints help information
    -V, --version                    Prints version information

OPTIONS:
        --crit-over &lt;M&gt;                               Error if there are more than &lt;M&gt; procs matching &lt;pattern&gt;
        --crit-under &lt;N&gt;                              Error if there are fewer than &lt;N&gt; procs matching &lt;pattern&gt;
        --kill-parents-of-matching &lt;PARENT_SIGNAL&gt;
            If *any* processes match, then kill their parents with the provided signal which can be either an integer or
            a name like KILL or SIGTERM. This has the same exit status behavior as kill-matching.
        --kill-matching &lt;SIGNAL&gt;
            If *any* processes match, then kill them with the provided signal which can be either an integer or a name
            like KILL or SIGTERM. This option does not affect the exit status, all matches are always killed, and if
            --crit-under/over are violated then then this will still exit critical.
        --state &lt;states&gt;...
            Filter to only processes in these states. If passed multiple times, processes matching any state are
            included.
            Choices: running sleeping uninterruptible-sleep waiting stopped zombie

ARGS:
    &lt;pattern&gt;    Regex that command and its arguments must match

Examples:

    Ensure at least two nginx processes are running:

        check-procs --crit-under 2 nginx

    Ensure there are not more than 30 zombie proccesses on the system:

        check-procs --crit-over 30 --state zombie

    Ensure that there are not more than 5 java processes running MyMainClass
    that are in the zombie *or* waiting states:

        check-procs --crit-over 5 --state zombie --state waiting 'java.*MyMainClass'

    Ensure that there are at least three (running or waiting) (cassandra or
    postgres) processes:

        check-procs --crit-under 3 --state running --state waiting 'cassandra|postgres'

</code></pre>
<h1 id="check-fs-writeable" class="section-header"><a href="#check-fs-writeable">check-fs-writeable</a></h1>
<pre><code class="language-plain">$ check-fs-writeable --help
check-fs-writeable (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check that we can write to a filesystem by writing a byte to a file.

Does not try to create the directory, or do anything else. Just writes a single byte to a file, errors if it cannot, and
then deletes the file.

USAGE:
    check-fs-writeable &lt;filename&gt;

FLAGS:
    -h, --help       Prints help information
    -V, --version    Prints version information

ARGS:
    &lt;filename&gt;    The file to write to

</code></pre>
<h1 id="check-disk" class="section-header"><a href="#check-disk">check-disk</a></h1>
<p>Unix only.</p>
<pre><code class="language-plain">$ check-disk --help
check-disk (part of tabin-plugins) 0.3.0
Brandon W Maister &lt;quodlibetor@gmail.com&gt;
Check all mounted file systems for disk usage.

For some reason this check generally generates values that are between 1% and 3% higher than `df`, even though AFAICT
we're both just calling statvfs a bunch of times.

USAGE:
    check-disk [FLAGS] [OPTIONS]

FLAGS:
    -h, --help       Prints help information
        --info       Print information of all known filesystems. Similar to df.
    -V, --version    Prints version information

OPTIONS:
    -c, --crit &lt;crit&gt;                        Percent to go critical at [default: 90]
    -C, --crit-inodes &lt;crit_inodes&gt;          Percent of inode usage to go critical at [default: 90]
        --exclude-type &lt;exclude-fs-type&gt;     Do not check filesystems that are of this type.
        --exclude-pattern &lt;exclude-regex&gt;    Only check filesystems that match this regex
        --type &lt;fs-type&gt;                     Only check filesystems that are of this type, e.g. ext4 or tmpfs. See 'man
                                             8 mount' for more examples.
        --pattern &lt;regex&gt;                    Only check filesystems that match this regex
    -w, --warn &lt;warn&gt;                        Percent to warn at [default: 80]
    -W, --warn-inodes &lt;warn_inodes&gt;          Percent of inode usage to warn at [default: 80]

</code></pre>
</div></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt><kbd>?</kbd></dt>
                    <dd>Show this help dialog</dd>
                    <dt><kbd>S</kbd></dt>
                    <dd>Focus the search field</dd>
                    <dt><kbd>↑</kbd></dt>
                    <dd>Move up in search results</dd>
                    <dt><kbd>↓</kbd></dt>
                    <dd>Move down in search results</dd>
                    <dt><kbd>↹</kbd></dt>
                    <dd>Switch tab</dd>
                    <dt><kbd>&#9166;</kbd></dt>
                    <dd>Go to active search result</dd>
                    <dt><kbd>+</kbd></dt>
                    <dd>Expand all sections</dd>
                    <dt><kbd>-</kbd></dt>
                    <dd>Collapse all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "tabin_plugins";
    </script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>